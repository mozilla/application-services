---
id: end-to-end-encryption
title: End-to-end encryption
---

Firefox Accounts offers an end-to-end encryption support feature for OAuth reliers by deriving a strong encryption key from user's password. Keep in mind that Firefox Accounts does not provide a storage solution, it is up to you to use the generated key and encrypt the data with that key.

### WebExtensions

To use this feature in WebExtensions you need to do the following:

1.  [Register an OAuth client](https://developer.mozilla.org/en-US/docs/Mozilla/Tech/Firefox_Accounts/Introduction#OAuth_2.0_API) and an OAuth app scope with Firefox Accounts
2.  Install the [fxa-crypto-relier](https://github.com/mozilla/fxa-crypto-relier) library into your WebExtension
3.  [Follow the documentation](https://github.com/mozilla/fxa-crypto-relier/tree/master/docs) to trigger the Firefox Accounts login screen
4.  Consume the derived key after the successful login

### Examples

You can find an example of this feature in the [TestPilot Notes source code](https://github.com/mozilla/notes/blob/5be89e52956182e57356b7ba9102d57cdb72be6f/src/background.js#L53-L72). Here's a simplified diagram of a scoped key generated for a WebExtension:

![](https://www.lucidchart.com/publicSegments/view/53ce9405-4ab6-481f-b8fe-0d47c0d29723/image.jpeg)

An example of a key generated by Firefox Accounts: 

![](https://i.imgur.com/GdXHWVu.jpg)

The generated key can be imported using existing WebCrypto APIs:

```
function shared_key(key) {
  return crypto.subtle.importKey(
    'jwk',
    { kty: key.kty, k: key.k.replace(/=/, '') },
    'AES-KW',
    true,
    ['wrapKey', 'unwrapKey']
  );
}
```